var invideo = {
    player: null,
    settings: {
        div: "",
        wrapper: "mediaplayer",
        ie8: false,
        firstLoad: true,
        autostart: false,
        ads: {
            enabled: false,
            url: "",
            url2: "",
            width: 300,
            height: 250
        },
        btn: {
            text: "Close and Play",
            color: "#353535"
        },
        popupAds: {
            enabled: false,
            url: ""
        }
    },
    init: function(player) {

        this.player = player;

        if(this.settings.ads.enabled) {
            this.adsSetup();
        }

        if(this.settings.popupAds.enabled) {
            this.pausePopUpAds();
        }

        if(!this.settings.autostart) {
            this.showAds();
        }

    },
    setup: function (settings) {

        if((typeof settings.adsUrl != "undefined") && (settings.adsUrl != "")) {
            this.settings.ads.url = settings.adsUrl
            this.settings.ads.enabled = true
        }
        if(typeof settings.adsUrl2 != "undefined") {
            this.settings.ads.url2 = settings.adsUrl2
        }
        if(typeof settings.width != "undefined") {
            this.settings.ads.width = settings.width
        }
        if(typeof settings.height != "undefined") {
            this.settings.ads.height = settings.height
        }

        if(typeof settings.btnText != "undefined") {
            this.settings.btn.text = settings.btnText
        }
        if(typeof settings.btnColor != "undefined") {
            this.settings.btn.color = settings.btnColor
        }

        if(typeof settings.popupAds != "undefined") {
            this.settings.popupAds.enabled = settings.popupAds
        }
        if(typeof settings.popupUrl != "undefined") {
            this.settings.popupAds.url = settings.popupUrl
        }

        if(typeof settings.autostart != "undefined") {
            this.settings.autostart = settings.autostart
        }

        if(typeof document.addEventListener == "undefined") {
            this.settings.ie8 = true;
        }

        this.bindEvents();

    },
    adsSetup: function() {

        document.getElementById(this.settings.wrapper).style.position = "relative";

        var html = document.createElement("div");
        html.id = "invideo_wrapper";
        html.style.cssText = 'background: url("/img/opacity50.png");background: rgba(0,0,0,0.5);filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="#4cffffff", endColorstr="#4cffffff");position: absolute;top:0;left:0;bottom:0;right:0;z-index:900';
        html.style.display = "none";

        document.getElementById(this.settings.wrapper).appendChild(html);

        if ( this.settings.ie8 ) {
            document.getElementById("invideo_wrapper").attachEvent("onclick", function() {invideo.play()});
        } else {
            document.getElementById("invideo_wrapper").addEventListener('click', function() {invideo.play()});
        }

        if(!this.settings.autostart) {
            this.adsTemplate();
        } else {
            this.settings.firstLoad = false;
        }

    },
    adsTemplate: function() {

        var width = this.settings.ads.width;
        var height = this.settings.ads.height;
        var html = document.getElementById("invideo_wrapper");

        var iframe = document.createElement("iframe");
        iframe.src = this.settings.ads.url;
        iframe.style.cssText = "border: none;";
        iframe.scrolling = "no";
        iframe.width =  this.settings.ads.width;
        iframe.height = this.settings.ads.height;
        iframe.id = 'adbe-square-invideo';

        if(this.settings.ads.url2 !=  "") {
            var iframe2 = document.createElement("iframe");
            iframe2.src = this.settings.ads.url2;
            iframe2.style.cssText = "border: none;";
            iframe2.style.marginLeft = "5px";
            iframe2.scrolling = "no";
            iframe2.width =  this.settings.ads.width;
            iframe2.height = this.settings.ads.height;

            width = (width*2)+5;
        }

        var marginLeft = width/2;
        var marginTop = (height/2)+50;

        var iframeWrapper = document.createElement("div");
        iframeWrapper.style.cssText = 'width:'+width+'px;height:'+height+'px;padding:5px;border-radius:5px;position:absolute;top:50%;left:50%;margin-left:-'+marginLeft+'px;margin-top:-'+marginTop+'px;background: #fff;text-align: center;';


        var btn = document.createElement("div");
        btn.style.cssText = 'padding:15px 0;color:#fff;border:1px solid #fff;font-size:20px;background:'+this.settings.btn.color+';width:200px;margin:20px -105px 0;border-radius:5px;cursor:pointer;position:absolute;top: 100%;left: 50%';
        btn.id = "close-and-play";
        btn.appendChild(document.createTextNode(this.settings.btn.text));

        html.appendChild(iframeWrapper);
        iframeWrapper.appendChild(iframe);
        if(this.settings.ads.url2 !=  "") {
            iframeWrapper.appendChild(iframe2);
            btn.style.margin = "20px -110px 0";
        }
        iframeWrapper.appendChild(btn);

        setTimeout(function() {
            document.getElementById('adbe-square-invideo').style.background = "url('http://t02.ashemaletube.com/beta/www/img/adblock.png')";
        }, 4500);

    },
    refreshAds: function() {
        var node = document.getElementById("invideo_wrapper");
        while (node.hasChildNodes()) {
            node.removeChild(node.lastChild);
        }
        this.adsTemplate();
    },
    pausePopUpAds: function () {

        var html = document.createElement("a");
        html.id = "invideo_wrapper_play";
        html.style.cssText = 'background: url("/img/opacity100.png");background: rgba(0,0,0,0.0);position: absolute;top:0;left:0;bottom:62px;right:0;z-index:900;';
        html.href = this.settings.popupAds.url;
        html.target = "_blank";
        html.style.display = "none";

        var html2 = document.createElement("a");
        html2.id = "invideo_wrapper_play1";
        html2.style.cssText = 'background: url("/img/opacity100.png");background: rgba(0,0,0,0.0);position: absolute;left:0;bottom:0;width:32px;height:32px;z-index:900;';
        html2.href = this.settings.popupAds.url;
        html2.target = "_blank";
        html2.style.display = "none";

        document.getElementById(this.settings.wrapper).appendChild(html);
        document.getElementById(this.settings.wrapper).appendChild(html2);

        if ( this.settings.ie8 ) {
            document.getElementById("invideo_wrapper_play").attachEvent("onclick", function() {invideo.pause()});
            document.getElementById("invideo_wrapper_play1").attachEvent("onclick", function() {invideo.pause()});
        } else {
            document.getElementById("invideo_wrapper_play").addEventListener('click', function() {invideo.pause()});
            document.getElementById("invideo_wrapper_play1").addEventListener('click', function() {invideo.pause()});
        }

    },
    hideAds: function() {

        if(this.settings.ads.enabled) {
            document.getElementById("invideo_wrapper").style.display = "none";
        }

        if(this.settings.popupAds.enabled) {
            document.getElementById("invideo_wrapper_play").style.display = "block";
            document.getElementById("invideo_wrapper_play1").style.display = "block";
        }

    },
    showAds: function() {
        if(!this.settings.firstLoad) {
            this.refreshAds();
        } else {
            this.settings.firstLoad = false;
        }


        if(this.settings.ads.enabled) {
            document.getElementById("invideo_wrapper").style.display = "block";
        }

        if(this.settings.popupAds.enabled) {
            document.getElementById("invideo_wrapper_play").style.display = "none";
            document.getElementById("invideo_wrapper_play1").style.display = "none";
        }


    },
    play: function() {

        this.hideAds();
        this.player.play();

    },
    pause: function() {

        this.showAds();
        this.player.pause();

    },
    bindEvents: function() {
        if ((typeof jwplayer === "function")) {
            jwplayer().onReady(function (e) {
                invideo.settings.wrapper = "mediaplayer_wrapper";
                invideo.init(jwplayer());
            });
            jwplayer().onPlay(function (e) {
                invideo.hideAds()
            });
            jwplayer().onPause(function (e) {
                invideo.showAds()
            });
            jwplayer().onComplete(function (e) {
                invideo.showAds()
            });
            jwplayer().onError(function (e) {
                invideo.showAds()
            });
            /*
             jwplayer().onPlay(function (e) {
             exoJw.state(e)
             });
             jwplayer().onPause(function (e) {
             exoJw.state(e)
             });
             jwplayer().onBuffer(function (e) {
             exoJw.state(e)
             });
             jwplayer().onIdle(function (e) {
             exoJw.state(e)
             });
             jwplayer().onTime(function (e) {
             exo.time(e.position)
             })
             */
        } else if(!!document.getElementById('movie').canPlayType) {
            var video = document.getElementById('movie');
            invideo.init(video)
            /*
             video.onloadeddata = function() {
             invideo.init(video)
             };
             */
            video.onplay = function() {
                invideo.hideAds()
            };
            video.onpause = function () {
                invideo.showAds()
            };
            /* na konci se zavola pause a pak ended hned
             video.onended = function () {
             alert("end")
             };
             */
        }
    }
};

